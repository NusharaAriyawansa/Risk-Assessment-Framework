{% extends 'base.html' %}
{% block title %}Dashboard - GRC Risk Assessment{% endblock %}

{% block content %}
<div class="page-header">
    <h1>Risk Dashboard</h1>
    <p class="subtitle">Overview of your organization's security posture</p>
</div>

<!-- Summary Cards -->
<div class="stats-grid">
    <div class="stat-card">
        <div class="stat-icon">ğŸ“Š</div>
        <div class="stat-content">
            <span class="stat-value">{{ total_assessments }}</span>
            <span class="stat-label">Total Assessments</span>
        </div>
    </div>
    <div class="stat-card critical">
        <div class="stat-icon">ğŸ”´</div>
        <div class="stat-content">
            <span class="stat-value">{{ critical_count }}</span>
            <span class="stat-label">Critical Risks</span>
        </div>
    </div>
    <div class="stat-card high">
        <div class="stat-icon">ğŸŸ </div>
        <div class="stat-content">
            <span class="stat-value">{{ high_count }}</span>
            <span class="stat-label">High Risks</span>
        </div>
    </div>
    <div class="stat-card medium">
        <div class="stat-icon">ğŸŸ¡</div>
        <div class="stat-content">
            <span class="stat-value">{{ medium_count }}</span>
            <span class="stat-label">Medium Risks</span>
        </div>
    </div>
    <div class="stat-card low">
        <div class="stat-icon">ğŸŸ¢</div>
        <div class="stat-content">
            <span class="stat-value">{{ low_count }}</span>
            <span class="stat-label">Low Risks</span>
        </div>
    </div>
</div>

<!-- Two Column Layout -->
<div class="dashboard-grid">
    <!-- Remediation Status -->
    <div class="card">
        <div class="card-header">
            <h2>Remediation Status</h2>
        </div>
        <div class="card-body">
            <div class="progress-bars">
                <div class="progress-item">
                    <div class="progress-label">
                        <span>Open</span>
                        <span class="count">{{ open_count }}</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill open" style="width: {{ (open_count / total_assessments * 100) if total_assessments > 0 else 0 }}%"></div>
                    </div>
                </div>
                <div class="progress-item">
                    <div class="progress-label">
                        <span>In Progress</span>
                        <span class="count">{{ in_progress_count }}</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill in-progress" style="width: {{ (in_progress_count / total_assessments * 100) if total_assessments > 0 else 0 }}%"></div>
                    </div>
                </div>
                <div class="progress-item">
                    <div class="progress-label">
                        <span>Closed</span>
                        <span class="count">{{ closed_count }}</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill closed" style="width: {{ (closed_count / total_assessments * 100) if total_assessments > 0 else 0 }}%"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Compliance Summary -->
    <div class="card">
        <div class="card-header">
            <h2>Compliance Status</h2>
            <a href="{{ url_for('compliance') }}" class="btn btn-sm">View All</a>
        </div>
        <div class="card-body">
            <div class="compliance-summary">
                <div class="compliance-stat">
                    <span class="big-number">{{ total_compliance }}</span>
                    <span class="label">Total Requirements</span>
                </div>
                <div class="compliance-stat">
                    <span class="big-number warning">{{ affected_compliance }}</span>
                    <span class="label">Affected by Risks</span>
                </div>
            </div>
            <div class="compliance-coverage">
                <div class="coverage-bar">
                    <div class="coverage-fill" style="width: {{ ((total_compliance - affected_compliance) / total_compliance * 100) if total_compliance > 0 else 100 }}%"></div>
                </div>
                <span class="coverage-label">{{ ((total_compliance - affected_compliance) / total_compliance * 100)|round|int if total_compliance > 0 else 100 }}% Compliant</span>
            </div>
        </div>
    </div>
</div>

<!-- Recent Assessments -->
<div class="card">
    <div class="card-header">
        <h2>Recent Risk Assessments</h2>
        <a href="{{ url_for('assess') }}" class="btn btn-primary">+ New Assessment</a>
    </div>
    <div class="card-body">
        {% if recent_assessments %}
        <table class="table">
            <thead>
                <tr>
                    <th>Asset</th>
                    <th>Threat</th>
                    <th>Risk Score</th>
                    <th>Level</th>
                    <th>Status</th>
                    <th>Date</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for assessment in recent_assessments %}
                <tr>
                    <td>
                        <strong>{{ assessment.asset.name }}</strong>
                        <span class="badge badge-{{ assessment.asset.criticality|lower }}">{{ assessment.asset.criticality }}</span>
                    </td>
                    <td>{{ assessment.threat.name }}</td>
                    <td class="risk-score">{{ assessment.risk_score }}</td>
                    <td>
                        <span class="badge badge-{{ assessment.risk_level|lower }}">{{ assessment.risk_level }}</span>
                    </td>
                    <td>
                        <span class="status status-{{ assessment.remediation_status|lower|replace(' ', '-') }}">
                            {{ assessment.remediation_status }}
                        </span>
                    </td>
                    <td>{{ assessment.created_at.strftime('%Y-%m-%d') }}</td>
                    <td>
                        <a href="{{ url_for('edit_assessment', id=assessment.id) }}" class="btn btn-sm">Edit</a>
                        <a href="{{ url_for('assessment_compliance', id=assessment.id) }}" class="btn btn-sm btn-outline">Compliance</a>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        {% else %}
        <div class="empty-state">
            <p>No assessments yet. <a href="{{ url_for('assess') }}">Create your first assessment</a></p>
        </div>
        {% endif %}
    </div>
</div>

<!-- Quick Actions -->
<div class="quick-actions">
    <h3>Quick Actions</h3>
    <div class="action-buttons">
        <a href="{{ url_for('assess') }}" class="action-btn">
            <span class="action-icon">ğŸ“</span>
            <span>New Assessment</span>
        </a>
        <a href="{{ url_for('add_asset') }}" class="action-btn">
            <span class="action-icon">ğŸ’»</span>
            <span>Add Asset</span>
        </a>
        <a href="{{ url_for('report') }}" class="action-btn">
            <span class="action-icon">ğŸ“ˆ</span>
            <span>View Report</span>
        </a>
        <a href="{{ url_for('add_policy') }}" class="action-btn">
            <span class="action-icon">ğŸ“‹</span>
            <span>Add Policy</span>
        </a>
    </div>
</div>
{% endblock %}
