{% extends 'base.html' %}
{% block title %}Compliance Overview - GRC Risk Assessment{% endblock %}

{% block content %}
<div class="page-header">
    <h1>Compliance Overview</h1>
    <p class="subtitle">View regulatory requirements and their associated risks</p>
</div>

{% for regulation, requirements in regulations.items() %}
<div class="card regulation-card">
    <div class="card-header regulation-header">
        <div class="regulation-info">
            <h2>
                {% if regulation == 'GDPR' %}ğŸ‡ªğŸ‡º
                {% elif regulation == 'HIPAA' %}ğŸ¥
                {% elif regulation == 'PCI-DSS' %}ğŸ’³
                {% else %}ğŸ“‹{% endif %}
                {{ regulation }}
            </h2>
            <span class="req-count">{{ requirements|length }} requirements</span>
        </div>
        <div class="regulation-stats">
            {% set affected = requirements|selectattr('assessment_count', 'gt', 0)|list|length %}
            {% if affected > 0 %}
            <span class="stat-affected">{{ affected }} affected by risks</span>
            {% else %}
            <span class="stat-ok">âœ“ No risks mapped</span>
            {% endif %}
        </div>
    </div>
    <div class="card-body">
        <table class="table compliance-table">
            <thead>
                <tr>
                    <th>Requirement ID</th>
                    <th>Name</th>
                    <th>Category</th>
                    <th>Linked Risks</th>
                    <th>Max Risk</th>
                </tr>
            </thead>
            <tbody>
                {% for item in requirements %}
                <tr class="{% if item.assessment_count > 0 %}has-risks{% endif %}">
                    <td>
                        <code>{{ item.requirement.requirement_id }}</code>
                    </td>
                    <td>
                        <strong>{{ item.requirement.name }}</strong>
                        {% if item.requirement.description %}
                        <p class="text-muted small">{{ item.requirement.description[:100] }}{% if item.requirement.description|length > 100 %}...{% endif %}</p>
                        {% endif %}
                    </td>
                    <td>
                        <span class="category-tag">{{ item.requirement.category }}</span>
                    </td>
                    <td class="center">
                        {% if item.assessment_count > 0 %}
                        <span class="count-badge warning">{{ item.assessment_count }}</span>
                        {% else %}
                        <span class="count-badge success">0</span>
                        {% endif %}
                    </td>
                    <td>
                        {% if item.max_risk_score > 0 %}
                        <span class="badge badge-{{ item.max_risk_level|lower }}">
                            {{ item.max_risk_score }} ({{ item.max_risk_level }})
                        </span>
                        {% else %}
                        <span class="text-muted">â€”</span>
                        {% endif %}
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% endfor %}

<div class="info-box">
    <h4>About Compliance Mapping</h4>
    <p>Each risk assessment can be linked to one or more compliance requirements. This helps you understand:</p>
    <ul>
        <li>Which regulatory requirements are impacted by identified risks</li>
        <li>Priority for remediation based on compliance obligations</li>
        <li>Audit readiness and evidence collection needs</li>
    </ul>
    <p>To map risks to compliance requirements, go to any assessment and click "Compliance" to add mappings.</p>
</div>
{% endblock %}
